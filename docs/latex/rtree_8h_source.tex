\doxysection{rtree.\+h}
\hypertarget{rtree_8h_source}{}\label{rtree_8h_source}\index{src/rtree/rtree.h@{src/rtree/rtree.h}}
\mbox{\hyperlink{rtree_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <any>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <initializer\_list>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <iterator>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <limits>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <queue>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <stack>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <stdexcept>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceGutman}{Gutman}}\ \{}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceGutman_a6fc9dea3297bbff7cccd3b5c350bbb0e}{equal}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{double}\ eps\ =\ 1e-\/7)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordflow}{return}\ std::fabs(x\ -\/\ y)\ <=\ eps\ *\ (std::fabs(x)\ +\ std::fabs(y));}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00040\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\ \{}
\DoxyCodeLine{00041\ \ \ \ \ std::vector<double>\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}};\ \ }
\DoxyCodeLine{00042\ \ \ \ \ std::vector<double>\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}};\ \ }
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}(\textcolor{keyword}{const}\ std::vector<double>\&\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}},\ \textcolor{keyword}{const}\ std::vector<double>\&\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}})}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}(\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}),\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}(\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}})\ \{\}}
\DoxyCodeLine{00051\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structGutman_1_1Rectangle_afb9415f3cd6bc2aba21fd4ba8eed4c6b}{area}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a\ =\ 1;}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.size();\ i++)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ a\ *=\ std::fabs(\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}[i]\ -\/\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}[i]);}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a;}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7e04f840fb327374b8e3183c5d8230a7}{enlargement\_needed}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ b)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ mbr\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{calc\_mbr}}(*\textcolor{keyword}{this},\ b);}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mbr.area()\ -\/\ \mbox{\hyperlink{structGutman_1_1Rectangle_afb9415f3cd6bc2aba21fd4ba8eed4c6b}{area}}();}
\DoxyCodeLine{00066\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a85c5e27db8fa1982b91a47e616e365dc}{contains}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ a)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.size();\ i++)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ flag\ =\ flag\ \&\&\ \mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}[i]\ <\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}[i]\ \&\&\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}[i]\ <\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}[i];}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!flag)}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ flag;}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Itr>}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{calc\_mbr}}(Itr\ p,\ Itr\ q)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (q\ ==\ p)}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ std::range\_error(\textcolor{stringliteral}{"{}Calculating\ the\ MBR\ on\ an\ empty\ range"{}});}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ t\ =\ p++;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (q\ ==\ p)}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*t)-\/>mbr;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ n\ =\ p;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ agg\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{calc\_mbr}}((*n)-\/>mbr,\ (*t)-\/>mbr);}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ !=\ q)\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ agg\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{calc\_mbr}}(agg,\ (*n)-\/>mbr);}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ n++;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ agg;}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe92d244b5f38c86443b21c509c4123}{calc\_mbr}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ b)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ c\ =\ a;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ std::transform(a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.begin(),\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.end(),\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.begin(),\ c.min.begin(),}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keywordtype}{double}\ a,\ \textcolor{keywordtype}{double}\ b)\ \{\ return\ std::min(a,\ b);\ \});}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ std::transform(a.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}.begin(),\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}.end(),\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}.begin(),\ c.max.begin(),}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keywordtype}{double}\ a,\ \textcolor{keywordtype}{double}\ b)\ \{\ return\ std::max(a,\ b);\ \});}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ c;}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a00ef3a701560728729c3f63be0b00544}{calc\_mbr\_area}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ b)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{calc\_mbr}}(a,\ b).\mbox{\hyperlink{structGutman_1_1Rectangle_afb9415f3cd6bc2aba21fd4ba8eed4c6b}{area}}();}
\DoxyCodeLine{00105\ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a9dda200a5e0b25dd787cfdc15996f557}{vec\_equal}}(\textcolor{keyword}{const}\ std::vector<double>\&\ x,\ \textcolor{keyword}{const}\ std::vector<double>\&\ y)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ f\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ x.size();\ i++)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ f\ \&\&\ \mbox{\hyperlink{namespaceGutman_a6fc9dea3297bbff7cccd3b5c350bbb0e}{Gutman::equal}}(x[i],\ y[i]);}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!f)}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ f;}
\DoxyCodeLine{00115\ \ \ \ \ \}}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a6c42eee9c1cc05ceef6e287563721bfe}{equal}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ b)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a9dda200a5e0b25dd787cfdc15996f557}{vec\_equal}}(a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}},\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}})\ \&\&\ \mbox{\hyperlink{structGutman_1_1Rectangle_a9dda200a5e0b25dd787cfdc15996f557}{vec\_equal}}(a.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}},\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}});}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a9b5d7f0eb2863a069169cde7806d2b42}{overlap}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle_a0cfa9a835bac4414bcf6feb7c392f564}{Rectangle}}\&\ b)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ f\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}.size();\ i++)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ f\ =\ f\ \&\&\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}[i]\ >=\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}[i]\ \&\&\ a.\mbox{\hyperlink{structGutman_1_1Rectangle_a7029de348a41067f52b09d85bb16c166}{min}}[i]\ <=\ b.\mbox{\hyperlink{structGutman_1_1Rectangle_a2af88a0ace8b012b16baf989b7b9fb67}{max}}[i];}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!f)}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ f;}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \};}
\DoxyCodeLine{00136\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00137\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structGutman_1_1Node_a2109d6c2538c9a325417a77eece88b5e}{Node}}\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node_a2109d6c2538c9a325417a77eece88b5e}{Node}}*\ \mbox{\hyperlink{structGutman_1_1Node_ab46ecf01da0a3a9e632a3a166859dd22}{parent}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00140\ \ \ \ \ std::vector<Node*>\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00141\ \ \ \ \ std::vector<std::pair<T*,\ Rectangle>>\ \mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}};\ \ }
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00144\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structGutman_1_1Node_a1c957969394c35d58e06fefeaf64950e}{count}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}}\ ?\ \mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.size()\ :\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}}.size();\ \}}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node_a2109d6c2538c9a325417a77eece88b5e}{Node}}(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}},\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}})\ :\ \mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}}(\mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}}),\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}}(std::move(\mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}})),\ \mbox{\hyperlink{structGutman_1_1Node_ab46ecf01da0a3a9e632a3a166859dd22}{parent}}(nullptr)\ \{\}}
\DoxyCodeLine{00148\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node_a6e12bb4f939b298808629d4ee64f8a41}{\string~Node}}()\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ child\ :\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}})\ \textcolor{keyword}{delete}\ child;}
\DoxyCodeLine{00150\ \ \ \ \ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structGutman_1_1Node_a52983c2197388938a533640252db2a20}{update\_mbr}}()\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}}\ \&\&\ \mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.size())\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}}\ =\ \mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}[0].second;}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ entry\ :\ \mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}})\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}}\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(\mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}},\ entry.second);}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>mbr\ =\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}};}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Node_a9b907462a22739ac50bd56440a39c248}{is\_leaf}}\ \&\&\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}}.size())\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}}\ =\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}}[0]-\/>mbr;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ node\ :\ \mbox{\hyperlink{structGutman_1_1Node_a970461ca2c3bc6d11ca1147126aca9d4}{children}})\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}}\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(\mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}},\ node-\/>mbr);}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>mbr\ =\ \mbox{\hyperlink{structGutman_1_1Node_a967eb7d16e9741558900c32449d44487}{mbr}};}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \};}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00177\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00178\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classGutman_1_1RTree_a071ba9586d0b5cde478abd863fa5da8d}{RTree}}\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{int}\ m;\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordtype}{int}\ M;\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node}{Node<T>}}*\ root;\ \ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ size;\ \ \ \ }
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_a071ba9586d0b5cde478abd863fa5da8d}{RTree}}(\textcolor{keywordtype}{int}\ m,\ \textcolor{keywordtype}{int}\ M)\ :\ root(nullptr),\ m(m),\ M(M),\ size(0)\ \{\}}
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_af5c6c2cfee4cee858b1632a4694f93a3}{\string~RTree}}()\ \{\ \textcolor{keyword}{delete}\ root;\ \}}
\DoxyCodeLine{00194\ \ \ \ \ std::vector<T*>\ \mbox{\hyperlink{classGutman_1_1RTree_a62adfb6e363cd7c19fd1c8580cc24302}{search}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\&\ search\_rect)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ std::vector<T*>\ result;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \_impl\_search(search\_rect,\ result,\ root);}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00198\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGutman_1_1RTree_aaeb73e39deab43186fcd102d7c021903}{insert}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\&\ mbr,\ T*\ elem)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!root)\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ root\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structGutman_1_1Node}{Node<T>}}(\textcolor{keyword}{true},\ mbr);}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>elems.push\_back(\{elem,\ mbr\});}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ size++;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node}{Node<T>}}*\ leaf\ =\ choose\_leaf(mbr,\ root);}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node}{Node<T>}}*\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_a1c957969394c35d58e06fefeaf64950e}{count}}()\ <\ M)\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.push\_back(\{elem,\ mbr\});}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ invoke\ split\ to\ get\ L\ and\ LL\ containing\ current\ entry\ E\ and\ all\ previous\ leaf\ entries}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.push\_back(\{elem,\ mbr\});}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ =\ split(leaf);}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ adjust\_tree(leaf,\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ size++;}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ root\ is\ split\ grow\ the\ tree\ taller}}
\DoxyCodeLine{00225\ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGutman_1_1RTree_a8b49800eb4985480a273777a7c7492cc}{remove}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\&\ r)\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!root)}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ leaf\ containing\ this\ rectangle}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Node}{Node<T>}}*\ leaf\ =\ find\_leaf(r,\ root);}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!leaf)}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ Rectangle\ not\ found}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ entry\ from\ the\ leaf}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::find\_if(leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.begin(),\ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.end(),}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [\&r](\textcolor{keyword}{const}\ std::pair<T*,\ Rectangle>\&\ elem)\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ Rectangle::equal(elem.second,\ r);}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.end())\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_aec1d3d95da55292f0923ce99dafcd1ed}{elems}}.erase(it);}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ size-\/-\/;}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Condense\ the\ tree}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ leaf-\/>\mbox{\hyperlink{structGutman_1_1Node_a52983c2197388938a533640252db2a20}{update\_mbr}}();}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(leaf,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \_condense\_tree(leaf);}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ condense\_tree(leaf);}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ //\ If\ root\ has\ only\ one\ child\ and\ is\ not\ a\ leaf,\ make\ that\ child\ the\ new\ root}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (root\ \&\&\ !root-\/>is\_leaf\ \&\&\ root-\/>count()\ ==\ 1)\ \{}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ Node<T>*\ old\_root\ =\ root;}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ root\ =\ root-\/>children[0];}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ root-\/>parent\ =\ nullptr;}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ for\ (auto\&\ child\ :\ old\_root-\/>children)\ child\ =\ nullptr;}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ old\_root-\/>children.clear();\ \ //\ Prevent\ deletion\ of\ the\ new\ root}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ delete\ old\_root;}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ //\ If\ root\ is\ a\ leaf\ and\ empty,\ set\ root\ to\ nullptr}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (root\ \&\&\ root-\/>is\_leaf\ \&\&\ root-\/>count()\ ==\ 0)\ \{}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ delete\ root;}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ root\ =\ nullptr;}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00268\ \ \ \ \ \}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGutman_1_1RTree_a061bd65595c90ca5c7b6999540b32e69}{update}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\&\ current,\ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\&\ desired,\ T*\ new\_elem)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_a8b49800eb4985480a273777a7c7492cc}{remove}}(current);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_aaeb73e39deab43186fcd102d7c021903}{insert}}(desired,\ new\_elem);}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keyword}{struct\ }EntryWrapper\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index;}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structGutman_1_1Rectangle}{Rectangle}}\ rect;}
\DoxyCodeLine{00279\ \ \ \ \ \};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordtype}{void}\ condense\_tree(Node<T>*\ l)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ Node<T>*\ n\ =\ l;}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ std::vector<Node<T>*>\ q;\ \ \textcolor{comment}{//\ Set\ of\ eliminated\ nodes\ to\ reinsert}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ !=\ root)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ p\ =\ n-\/>parent;}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n-\/>count()\ <\ m)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ n\ from\ parent's\ children\ list}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::find(p-\/>children.begin(),\ p-\/>children.end(),\ n);}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ p-\/>children.end())\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p-\/>children.erase(it);}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRITICAL:\ Set\ parent\ to\ nullptr\ to\ mark\ this\ node\ as\ orphaned}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>parent\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ to\ elimination\ list}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ q.push\_back(n);}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Node\ is\ not\ underflow,\ just\ update\ its\ MBR}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(n);}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ move\ to\ parent}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ p;}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ root\ MBR\ if\ it\ still\ exists\ and\ has\ children}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (root\ \&\&\ root-\/>count()\ >\ 0)\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(root);}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reinsert\ all\ entries\ from\ eliminated\ nodes}}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ std::vector<std::pair<T*,\ Rectangle>>\ leaf\_entries;}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node<T>*\ orphan\ :\ q)\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (orphan-\/>is\_leaf)\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Collect\ leaf\ entries}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\ :\ orphan-\/>elems)\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leaf\_entries.push\_back(elem);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ to\ prevent\ destructor\ issues}}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\ :\ orphan-\/>elems)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elem.first\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orphan-\/>elems.clear();}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ orphan;}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ non-\/leaf\ nodes,\ collect\ all\ leaf\ entries\ from\ subtree}}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collect\_data\_from\_subtree(orphan,\ leaf\_entries);}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Destructor\ will\ handle\ cleanup}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ orphan;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reinsert\ all\ collected\ entries}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ entry\ :\ leaf\_entries)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_aaeb73e39deab43186fcd102d7c021903}{insert}}(entry.second,\ entry.first);}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{keywordtype}{void}\ \_impl\_search(\textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ s,\ std::vector<T*>\&\ result,\ Node<T>*\ t\ =\ \textcolor{keyword}{nullptr})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ root;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>is\_leaf)\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\_rec\ :\ t-\/>elems)\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Rectangle_a9b5d7f0eb2863a069169cde7806d2b42}{Rectangle::overlap}}(elem\_rec.second,\ s))}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ result.push\_back(elem\_rec.first);}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ node\ :\ t-\/>children)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Rectangle_a9b5d7f0eb2863a069169cde7806d2b42}{Rectangle::overlap}}(node-\/>mbr,\ s))\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<T*>\ r;}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_impl\_search(s,\ r,\ node);}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::copy(r.begin(),\ r.end(),\ std::back\_inserter(result));}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00364\ \ \ \ \ \}}
\DoxyCodeLine{00365\ \ \ \ \ Node<T>*\ choose\_leaf(\mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\ s,\ Node<T>*\ n\ =\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!n)}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ root;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!n)}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n-\/>is\_leaf)}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ min\_area\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ min\_enlarge\ =\ min\_area;}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ leaf\ =\ n;}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ node\ :\ n-\/>children)\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ e\ =\ node-\/>mbr.enlargement\_needed(s);}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespaceGutman_a6fc9dea3297bbff7cccd3b5c350bbb0e}{equal}}(e,\ min\_enlarge)\ \&\&\ e\ <\ min\_enlarge)\ \{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_enlarge\ =\ e;}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_area\ =\ node-\/>mbr.area();}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leaf\ =\ node;}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespaceGutman_a6fc9dea3297bbff7cccd3b5c350bbb0e}{equal}}(e,\ min\_enlarge)\ \&\&\ node-\/>mbr.area()\ <\ min\_area)\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_enlarge\ =\ e;}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_area\ =\ node-\/>mbr.area();}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leaf\ =\ node;}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ choose\_leaf(s,\ leaf);}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordtype}{void}\ adjust\_tree(Node<T>*\ l,\ Node<T>*\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}})\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (l\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Always\ update\ the\ MBR\ of\ the\ node\ we're\ adjusting}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (l-\/>count()\ >\ 0)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(l);}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ p\ =\ l-\/>parent;}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (l-\/>count()\ >\ M)\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ =\ split(l);}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(l,\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ ==\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ !=\ \textcolor{keyword}{nullptr})\ \{\ \ \textcolor{comment}{//\ root\ was\ split}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ rect\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(\mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}-\/>mbr,\ l-\/>mbr);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ root\ =\ \textcolor{keyword}{new}\ Node<T>(\textcolor{keyword}{false},\ rect);}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>children\ =\ std::vector<Node<T>*>\{l,\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\};}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ l-\/>parent\ =\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}-\/>parent\ =\ root;}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (p\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ ==\ \textcolor{keyword}{nullptr})\ \{\ \ \textcolor{comment}{//\ just\ adjust\ the\ mbr}}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(p);}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(p,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ split\ if\ needed}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ p-\/>children.push\_back(\mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}-\/>parent\ =\ p;}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ pp\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (p-\/>count()\ >\ M)\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pp\ =\ split(p);}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(p);}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}})}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ update\_mbr(\mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(p,\ pp);}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \ \ Node<T>*\ split(Node<T>*\ t)\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ apply\ pickseeds}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ std::vector<EntryWrapper>\ entries;}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ std::vector<bool>\ assigned(t-\/>count(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>is\_leaf)\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ t-\/>count();\ i++)}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entries.push\_back(EntryWrapper\{i,\ t-\/>elems[i].second\});}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ t-\/>count();\ i++)}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entries.push\_back(EntryWrapper\{i,\ t-\/>children[i]-\/>mbr\});}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ seeds\ =\ pick\_seeds(entries);}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ assigned[seeds.first]\ =\ assigned[seeds.second]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ t-\/>count();}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ mbr1\ =\ entries[seeds.first].rect;}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ mbr2\ =\ entries[seeds.second].rect;}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ std::vector<int>\ g1\{seeds.first\},\ g2\{seeds.second\};}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ i++)\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ next\ =\ pick\_next(entries,\ assigned,\ mbr1,\ mbr2);}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (next\ <\ 0)}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ assigned[next]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ c1\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(mbr1,\ entries[next].rect);}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ c2\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(mbr2,\ entries[next].rect);}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (c1.area()\ <\ c2.area())\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mbr1\ =\ c1;}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g1.push\_back(next);}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mbr2\ =\ c2;}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g2.push\_back(next);}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enforce\ minimum\ entries\ per\ node}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (g1.size()\ <\ m\ ||\ g2.size()\ <\ m)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ big\ =\ g1.size()\ >\ g2.size()\ ?\ g1\ :\ g2;}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ small\ =\ g1.size()\ <\ g2.size()\ ?\ g1\ :\ g2;}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (small.size()\ <\ m)\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ small.push\_back(big.back());}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ big.pop\_back();}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Recalculate\ MBRs\ after\ redistribution}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ mbr1\ =\ entries[g1[0]].rect;}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ g1.size();\ i++)\ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mbr1\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(mbr1,\ entries[g1[i]].rect);}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ mbr2\ =\ entries[g2[0]].rect;}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ g2.size();\ i++)\ \{}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mbr2\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(mbr2,\ entries[g2[i]].rect);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tt\ =\ \textcolor{keyword}{new}\ Node<T>\{t-\/>is\_leaf,\ mbr2\};}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ tt-\/>parent\ =\ t-\/>parent;}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ t-\/>mbr\ =\ mbr1;}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>is\_leaf)\ \{}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<T*,\ Rectangle>>\ elems1;}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<T*,\ Rectangle>>\ elems2;}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ :\ g1)\ elems1.push\_back(t-\/>elems[i]);}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ :\ g2)\ elems2.push\_back(t-\/>elems[i]);}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ t-\/>elems)\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ e.first\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>elems\ =\ elems1;}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ tt-\/>elems\ =\ elems2;}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<Node<T>*>\ elems1;}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<Node<T>*>\ elems2;}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ :\ g1)\ elems1.push\_back(t-\/>children[i]);}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ i\ :\ g2)\ elems2.push\_back(t-\/>children[i]);}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ e\ :\ t-\/>children)\ \{}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ e\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \ \ \ \ t-\/>children\ =\ elems1;}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \ tt-\/>children\ =\ elems2;}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ parent\ pointers}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ child\ :\ t-\/>children)\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ child-\/>parent\ =\ t;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ child\ :\ tt-\/>children)\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ child-\/>parent\ =\ tt;}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tt;}
\DoxyCodeLine{00534\ \ \ \ \ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \ \ Node<T>*\ find\_leaf(\textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ r,\ Node<T>*\ t\ =\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ root;}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ ==\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>is\_leaf)\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\_rec\ :\ t-\/>elems)\ \{}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Rectangle_a6c42eee9c1cc05ceef6e287563721bfe}{Rectangle::equal}}(elem\_rec.second,\ r))}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ t;}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ node\ :\ t-\/>children)\ \{}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structGutman_1_1Rectangle_a9b5d7f0eb2863a069169cde7806d2b42}{Rectangle::overlap}}(node-\/>mbr,\ r))\ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ leaf\ =\ find\_leaf(r,\ node);}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leaf)}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ leaf;}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00558\ \ \ \ \ \}}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \ \ std::pair<int,\ int>\ pick\_seeds(\textcolor{keyword}{const}\ std::vector<EntryWrapper>\&\ entries)\ \{}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_waste\ =\ -\/1;}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ entries.size();}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ std::pair<int,\ int>\ seeds\{-\/1,\ -\/1\};}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ i++)\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ n;\ j++)\ \{}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ j)}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ b\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(entries[i].rect,\ entries[j].rect);}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ d\ =\ b.area()\ -\/\ entries[i].rect.area()\ -\/\ entries[j].rect.area();}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::fabs(d)\ >\ max\_waste)\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_waste\ =\ d;}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seeds.first\ =\ i;}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seeds.second\ =\ j;}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ seeds;}
\DoxyCodeLine{00578\ \ \ \ \ \}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordtype}{int}\ pick\_next(\textcolor{keyword}{const}\ std::vector<struct\ EntryWrapper>\&\ entries,}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<bool>\&\ assigned,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ mbr1,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ mbr2)\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ entries.size();}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_diff\ =\ -\/100000;}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ max\_i\ =\ -\/1;}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ n;\ i++)\ \{}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (assigned[i])}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ d1\ =\ mbr1.\mbox{\hyperlink{structGutman_1_1Rectangle_a7e04f840fb327374b8e3183c5d8230a7}{enlargement\_needed}}(entries[i].rect);}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ d2\ =\ mbr2.\mbox{\hyperlink{structGutman_1_1Rectangle_a7e04f840fb327374b8e3183c5d8230a7}{enlargement\_needed}}(entries[i].rect);}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::fabs(d1\ -\/\ d2)\ >\ max\_diff)\ \{}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_i\ =\ i;}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_diff\ =\ std::fabs(d1\ -\/\ d2);}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ max\_i;}
\DoxyCodeLine{00596\ \ \ \ \ \}}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{keywordtype}{void}\ update\_mbr(Node<T>*\ n)\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!n\ ||\ n-\/>count()\ ==\ 0)}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n-\/>is\_leaf)\ \{}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ MBR\ from\ elements}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>mbr\ =\ n-\/>elems[0].second;}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ n-\/>elems.size();\ i++)\ \{}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>mbr\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(n-\/>mbr,\ n-\/>elems[i].second);}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ MBR\ from\ children}}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>mbr\ =\ n-\/>children[0]-\/>mbr;}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ n-\/>children.size();\ i++)\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>mbr\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(n-\/>mbr,\ n-\/>children[i]-\/>mbr);}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00615\ \ \ \ \ \}}
\DoxyCodeLine{00616\ }
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordtype}{void}\ collect\_data\_from\_subtree(Node<T>*\ node,\ std::vector<std::pair<T*,\ Rectangle>>\&\ data)\ \{}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_leaf)\ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\ :\ node-\/>elems)\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data.push\_back(elem);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ elem\ :\ node-\/>elems)\ \{}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ elem.first\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ to\ prevent\ double-\/delete}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>elems.clear();}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ child\ :\ node-\/>children)\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collect\_data\_from\_subtree(child,\ data);}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ children\ to\ prevent\ destructor\ from\ deleting\ them}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (we\ already\ processed\ them\ recursively)}}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ child\ :\ node-\/>children)\ child\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ node-\/>children.clear();\ \ \textcolor{comment}{//\ OVO\ NIJE\ TACNO\ .CLEAR\ zove\ destruktore}}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00636\ \ \ \ \ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{keywordtype}{void}\ \_condense\_tree(Node<T>*\ l)\ \{}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ Node<T>*\ n\ =\ l;}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ std::vector<Node<T>*>\ orphans;}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1.\ ASCEND\ AND\ COLLECT}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (n\ !=\ root)\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ p\ =\ n-\/>parent;}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n-\/>count()\ <\ m)\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ std::find(p-\/>children.begin(),\ p-\/>children.end(),\ n);}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ p-\/>children.end())}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p-\/>children.erase(it);}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>parent\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ orphans.push\_back(n);}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ n-\/>update\_mbr();}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ p;}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2.\ ROOT\ SANITY\ CHECK\ (Fixes\ Extreme\ Condense/Massive\ Delete)}}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ root\ was\ internal\ but\ all\ children\ were\ removed,\ it\ is\ now\ invalid.}}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ it\ to\ an\ empty\ leaf.}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!root-\/>is\_leaf\ \&\&\ root-\/>children.empty())\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>is\_leaf\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>elems.clear();\ \ \textcolor{comment}{//\ Ensure\ clean\ state}}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ root-\/>update\_mbr();}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3.\ RE-\/INSERT\ ORPHANS}}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node<T>*\ orphan\ :\ orphans)\ \{}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (orphan-\/>is\_leaf)\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Re-\/insert\ Data}}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ entry\ :\ orphan-\/>elems)\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGutman_1_1RTree_aaeb73e39deab43186fcd102d7c021903}{insert}}(entry.second,\ entry.first);}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Re-\/insert\ Subtrees\ (Internal\ Nodes)}}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node<T>*\ child\_subtree\ :\ orphan-\/>children)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ insert\_internal(child\_subtree);}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cleanup\ Orphan\ Container}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ \ orphan-\/>children.clear();}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ orphan-\/>elems.clear();}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ orphan;}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 4.\ ROOT\ HEIGHT\ REDUCTION}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!root-\/>is\_leaf\ \&\&\ root-\/>children.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ new\_root\ =\ root-\/>children[0];}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>children.clear();}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ root;}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ root\ =\ new\_root;}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>parent\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00694\ \ \ \ \ \}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \textcolor{keywordtype}{void}\ insert\_node\_at\_level(Node<T>*\ subtree,\ \textcolor{keywordtype}{int}\ level)\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1.\ Choose\ Subtree\ (Find\ the\ best\ parent\ for\ this\ node)}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ want\ a\ node\ at\ (level\ +\ 1)\ to\ be\ the\ parent.}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ Node<T>*\ target\_parent\ =\ choose\_subtree(root,\ subtree-\/>mbr,\ level);}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2.\ Add\ child}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ target\_parent-\/>children.push\_back(subtree);}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ subtree-\/>parent\ =\ target\_parent;}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ target\_parent-\/>update\_mbr();}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3.\ Handle\ Overflow\ (Split)\ if\ necessary}}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ propagates\ up\ just\ like\ a\ normal\ insert}}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_parent-\/>children.size()\ >\ M)\ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ =\ split(target\_parent);}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(target\_parent,\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00712\ \ \ \ \ \}}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ \ \ Node<T>*\ choose\_subtree(Node<T>*\ node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ rect,\ \textcolor{keywordtype}{int}\ insertion\_level)\ \{}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Base\ Case:\ If\ we\ are\ at\ the\ level\ immediately\ above\ the\ insertion\ level,}}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ node\ is\ the\ candidate\ parent.}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Example:\ Inserting\ a\ Leaf\ (level\ 0).\ We\ need\ a\ parent\ at\ Level\ 1\ (Internal).}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ You\ need\ a\ way\ to\ determine\ node\ height/level.}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ you\ don't\ store\ 'level'\ in\ Node,\ you\ calculate\ it\ based\ on\ distance\ to\ leaves.}}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ current\_level\ =\ get\_level(node);\ \ \textcolor{comment}{//\ See\ helper\ below}}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_level\ ==\ insertion\_level\ +\ 1)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Standard\ R-\/Tree\ logic:\ Find\ child\ requiring\ least\ enlargement}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ Node<T>*\ best\_child\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ min\_enlargement\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ best\_area\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node<T>*\ child\ :\ node-\/>children)\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ area\ =\ child-\/>mbr.area();}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ enlargement\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(child-\/>mbr,\ rect).\mbox{\hyperlink{structGutman_1_1Rectangle_afb9415f3cd6bc2aba21fd4ba8eed4c6b}{area}}()\ -\/\ area;}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (enlargement\ <\ min\_enlargement)\ \{}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_enlargement\ =\ enlargement;}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_area\ =\ area;}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_child\ =\ child;}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (enlargement\ ==\ min\_enlargement)\ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (area\ <\ best\_area)\ \{}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_area\ =\ area;}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_child\ =\ child;}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00746\ }
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Recurse}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ choose\_subtree(best\_child,\ rect,\ insertion\_level);}
\DoxyCodeLine{00749\ \ \ \ \ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{keywordtype}{int}\ get\_level(Node<T>*\ node)\ \{}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lvl\ =\ 0;}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!node-\/>is\_leaf)\ \{}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Go\ down\ the\ first\ child\ until\ we\ hit\ a\ leaf}}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>children.empty())}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ Should\ not\ happen\ in\ valid\ tree}}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ node\ =\ node-\/>children[0];}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ lvl++;}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ lvl;}
\DoxyCodeLine{00761\ \ \ \ \ \}}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{keywordtype}{int}\ get\_height(Node<T>*\ n)\ \{}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ h\ =\ 0;}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!n-\/>is\_leaf\ \&\&\ !n-\/>children.empty())\ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ h++;}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ n-\/>children[0];}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ h;}
\DoxyCodeLine{00770\ \ \ \ \ \}}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \ \ Node<T>*\ choose\_subtree\_at\_level(Node<T>*\ node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{main_8cpp_a6375978ecb2c815628f632b6bd986afb}{Rectangle}}\&\ mbr,\ \textcolor{keywordtype}{int}\ target\_height)\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_leaf)}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;\ \ \textcolor{comment}{//\ Should\ not\ happen\ for\ internal\ insert,\ but\ safety\ first}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Guard\ against\ empty\ internal\ nodes\ (e.g.\ root\ temporarily\ empty)}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node-\/>children.empty())}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00779\ }
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Optimization:\ Check\ height\ of\ immediate\ children}}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ children\ are\ at\ the\ target\ height,\ then\ 'node'\ is\ the\ parent\ we\ want.}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ child\_height\ =\ get\_height(node-\/>children[0]);}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child\_height\ ==\ target\_height)\ \{}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Standard\ Min-\/Enlargement\ Search}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ Node<T>*\ best\_child\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ min\_enlargement\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ best\_area\ =\ std::numeric\_limits<double>::max();}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (Node<T>*\ child\ :\ node-\/>children)\ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ area\ =\ child-\/>mbr.area();}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ enlargement\ =\ \mbox{\hyperlink{structGutman_1_1Rectangle_a2fe039acef8056d3bbc0da22e0926283}{Rectangle::calc\_mbr}}(child-\/>mbr,\ mbr).\mbox{\hyperlink{structGutman_1_1Rectangle_afb9415f3cd6bc2aba21fd4ba8eed4c6b}{area}}()\ -\/\ area;}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (enlargement\ <\ min\_enlargement)\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_enlargement\ =\ enlargement;}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_area\ =\ area;}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_child\ =\ child;}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (enlargement\ ==\ min\_enlargement)\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (area\ <\ best\_area)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_area\ =\ area;}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ best\_child\ =\ child;}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ for\ some\ reason\ we\ didn't\ find\ a\ child\ (shouldn't\ happen),\ return\ node}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!best\_child)}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ choose\_subtree\_at\_level(best\_child,\ mbr,\ target\_height);}
\DoxyCodeLine{00813\ \ \ \ \ \}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \ \ \ \ \textcolor{comment}{//\ Function\ to\ re-\/insert\ a\ subtree\ (internal\ node)}}
\DoxyCodeLine{00816\ \ \ \ \ \textcolor{keywordtype}{void}\ insert\_internal(Node<T>*\ subtree)\ \{}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ subtree\_height\ =\ get\_height(subtree);}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ root\_height\ =\ get\_height(root);}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CASE:\ Tree\ is\ too\ short.}}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ orphan\ is\ as\ tall\ as\ the\ root,\ we\ must\ create\ a\ new\ root}}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ hold\ both\ the\ old\ root\ and\ the\ orphan.}}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (subtree\_height\ >=\ root\_height)\ \{}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ new\_root\ =\ \textcolor{keyword}{new}\ Node<T>(\textcolor{keyword}{false},\ root-\/>mbr);\ \ \textcolor{comment}{//\ Internal}}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \ \ \ new\_root-\/>children.push\_back(root);}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>parent\ =\ new\_root;}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ subtree\ also\ goes\ into\ this\ new\ root\ (or\ its\ appropriate\ level,}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ but\ if\ heights\ match,\ it\ goes\ here).}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ However,\ to\ keep\ logic\ uniform,\ we\ just\ update\ root\ and\ let\ choose\_subtree\ work.}}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \ \ \ root\ =\ new\_root;}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ root-\/>update\_mbr();}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ correct\ parent\ (guaranteed\ to\ exist\ now)}}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ Node<T>*\ target\_parent\ =\ choose\_subtree\_at\_level(root,\ subtree-\/>mbr,\ subtree\_height);}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Link}}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ target\_parent-\/>children.push\_back(subtree);}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ subtree-\/>parent\ =\ target\_parent;}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ MBRs}}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ target\_parent-\/>update\_mbr();}
\DoxyCodeLine{00844\ }
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ Overflow}}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (target\_parent-\/>children.size()\ >\ M)\ \{}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Assuming\ you\ have\ a\ standard\ split\ function}}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}}\ =\ split(target\_parent);}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\_tree(target\_parent,\ \mbox{\hyperlink{box_8h_ad54dde638d1ae3e9bb08956f539b1883}{ll}});}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Propagate\ MBR\ changes\ up}}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ Node<T>*\ p\ =\ target\_parent-\/>parent;}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (p)\ \{}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p-\/>update\_mbr();}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p\ =\ p-\/>parent;}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00858\ \ \ \ \ \}}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \textcolor{keywordtype}{void}\ reinsert\_subtree(Node<T>*\ node)\ \{\ \textcolor{keywordflow}{return};\ \}}
\DoxyCodeLine{00861\ \};}
\DoxyCodeLine{00862\ \}\ \ \textcolor{comment}{//\ namespace\ Gutman}}

\end{DoxyCode}
